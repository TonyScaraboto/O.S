<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='whatsapp.css') }}">
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            margin: 40px;
            color: #000;
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
        }

        .campo {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 15px;
        }

        .label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        .foto {
            margin-top: 20px;
            text-align: center;
        }


        .foto img {
            max-width: 220px;
            max-height: 180px;
            width: auto;
            height: auto;
            border: 1px solid #000;
            display: block;
            margin: 0 auto;
            page-break-inside: avoid;
        }

        .termo {
            font-size: 10px;
            white-space: pre-wrap;
            border: 1px solid #000;
            padding: 10px;
            margin-top: 30px;
        }


        .assinatura {
            margin-top: 40px;
            width: 100%;
            display: table;
            table-layout: fixed;
        }

        .assinatura .assin-col {
            display: table-cell;
            width: 50%;
            text-align: center;
            vertical-align: bottom;
            padding: 0 10px;
        }

        .linha {
            border-top: 1px solid #000;
            margin-top: 60px;
        }

        @media print {

            button,
            .whatsapp-float {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    {% if erro_pdf %}
    <div class="alert alert-danger" role="alert">
        <strong>Erro ao gerar PDF:</strong> {{ erro_pdf }}
        {% if request and request.host %}
        <div class="mt-1">Verifique a configuração do banco e do PDF no ambiente.</div>
        {% endif %}
    </div>
    {% endif %}

    {% set ctx = pdf_context or {} %}
    {% set cliente_display = ctx.get('cliente') %}
    {% if not cliente_display %}
    {% if ordem and ordem|length > 9 and ordem[9] %}
    {% set cliente_display = ordem[9] %}
    {% elif ordem and ordem|length > 1 %}
    {% set cliente_display = ordem[1] %}
    {% else %}
    {% set cliente_display = '' %}
    {% endif %}
    {% endif %}
    <h2>Ordem de Serviço #{{ ctx.get('ordem_dict', {}).get('id') or (ordem[0] if ordem else '') }}</h2>
    <button onclick="window.print()"
        style="position:fixed;top:20px;right:20px;z-index:999;background:#5865f2;color:#fff;border:none;padding:8px 18px;border-radius:6px;box-shadow:0 2px 8px #0002;cursor:pointer;font-size:1rem;">
        <i class="bi bi-printer"></i> Imprimir / Salvar PDF
    </button>

    <div class="campo">
        <span class="label">Cliente:</span>
        {{ cliente_display }}
    </div>

    <div class="campo">
        <span class="label">Telefone:</span>
        {{ ctx.get('telefone') or (ordem[2] if ordem and ordem|length > 2 else '') }}
    </div>

    <div class="campo">
        <span class="label">Aparelho:</span>
        {{ ctx.get('aparelho') or (ordem[3] if ordem and ordem|length > 3 else '') }}
    </div>

    <div class="campo">
        <span class="label">Defeito:</span>
        {{ ctx.get('defeito') or (ordem[4] if ordem and ordem|length > 4 else '') }}
    </div>

    <div class="campo">
        <span class="label">Valor (R$):</span>
        {{ ctx.get('valor_formatado') or ('%.2f'|format(ordem[5])|replace('.', ',') if ordem and ordem|length > 5 else
        '0,00') }}
    </div>

    {% if ctx.get('custo_formatado') %}
    <div class="campo">
        <span class="label">Custo da Peça (R$):</span>
        {{ ctx.get('custo_formatado') }}
    </div>
    {% elif ordem and ordem|length > 11 and ordem[11] %}
    <div class="campo">
        <span class="label">Custo da Peça (R$):</span>
        {{ '%.2f'|format(ordem[11])|replace('.', ',') }}
    </div>
    {% endif %}

    <div class="campo">
        <span class="label">Status:</span>
        {{ ctx.get('status') or (ordem[6] if ordem and ordem|length > 6 else 'Recebido') }}
    </div>

    <div class="campo">
        <span class="label">Data:</span>
        {{ ctx.get('data_formatada') or now.strftime('%d/%m/%y') }}
    </div>

    {% if foto_nome %}
    <div class="foto">
        <span class="label">Foto do Aparelho:</span>
        <img src="{{ foto_nome | safe }}" alt="Foto do aparelho">
    </div>
    {% endif %}

    <div class="termo">
        <strong>Termo de Garantia:</strong><br><br>
        NÃO ESTÃO INCLUSOS NESTA GARANTIA ALGUNS ACESSÓRIOS E TODAS AS PARTES EXTERNAS DO CELULAR TAIS COMO:
        Lentes, antenas, carcaças, capas, cases, teclas, teclados e botões laterais se houver, tampas, películas
        protetoras, cabos de dados, fones de ouvido, cartão de memória, pendrive, suportes e partes que se desgastam com
        o uso.
        A GARANTIA É CANCELADA AUTOMATICAMENTE NOS SEGUINTES CASOS:
        Em ocasião de quedas, esmagamentos, sobrecarga elétrica; exposição do aparelho a altas temperaturas, umidade ou
        líquidos; exposição do aparelho a poeira, pó e/ou limalha de metais, ou ainda quando constatado mau uso do
        aparelho, instalações, modificações ou atualizações no seu sistema operacional; abertura do equipamento ou
        tentativa de conserto deste por terceiros que não sejam os técnicos desta Assistência, mesmo que para realização
        de outros serviços; bem como a violação do selo/lacre de garantia colocado por esta Assistência.
        E ainda:
        LENTE TOUCHSCREEN QUE APRESENTEM MAU USO, TRINCADOS OU QUEBRADOS, RISCADOS, MANCHADOS, DESCOLADOS ou COM CABO
        FLEX ROMPIDO.
        Vale lembrar que:
        1) A GARANTIA DE 90 (NOVENTA) dias está de acordo com o artigo 26 inciso II do código de defesa do consumidor.
        2) Funcionamento, instalação e atualização de aplicativos, bem como o sistema operacional do aparelho NÃO FAZEM
        parte desta garantia.
        3) Limpeza e conservação do aparelho NÃO FAZEM parte desta garantia.
        4) A não apresentação de documento (nota fiscal ou este termo) que comprove o serviço INVÁLIDA a garantia.
        5) Qualquer mal funcionamento APÓS ATUALIZAÇÕES do sistema operacional ou aplicativos NÃO FAZEM PARTE DESSA
        GARANTIA.
        6) A GARANTIA é válida somente para o item ou serviço descrito na nota fiscal, ordem de serviço ou neste termo
        de garantia, NÃO ABRANGENDO OUTRAS PARTES e respeitando as condições aqui descritas.
    </div>


    <div class="assinatura">
        <div class="assin-col">
            <div class="linha"></div>
            <p>Assinatura do Cliente</p>
        </div>
        <div class="assin-col">
            <div class="linha"></div>
            <p>Assinatura da Assistência</p>
        </div>
    </div>

    <!-- WhatsApp Button Flutuante -->
    <a href="https://wa.me/5513991836523" target="_blank" class="whatsapp-float">
        <i class="bi bi-whatsapp"></i>
    </a>

</body>

</html>